<html>
    <head>
        <link rel="stylesheet" type="text/css" href="__ROOT__/Public/css/admin.min.css">
        <link rel="stylesheet" type="text/css" href="__ROOT__/Application/Admin/View/_Resource/css/default.css">
        <link rel="stylesheet" type="text/css" href="__CSS__/admin-public.css">
        <link rel="stylesheet" type="text/css" href="__CSS__/page.css">
        <script language="javascript" type="text/javascript" src="__COMMON_JS__/calendar/calendar.js"></script>
        <link rel="stylesheet" type="text/css" href="__COMMON_JS__/calendar/calendar-blue.css">
    </head>
    <body>
        <div class="clearfix full-container">
            <div class="container-fluid">
                <div class="row">
                    <!-- 左侧导航菜单开始 -->
                    <!-- 左侧导航菜单结束 -->

                    <!-- 页面主体内容开始 -->
                    <div id="main" class="col-xs-12 col-sm-10 main">
                        <div class="builder builder-form-box">
                            <div class="builder-container builder-form-container">
                                <div class="row">
                                    <div class="col-xs-12">
                                        <form action="" method="post" class=" builder-form">
                                            <div class="form-group item_index_template 1">
                                                <label class="item-label">商家名称：<span class="check-tips"><span class="small" style="color: #3B3B3B;">{$g_name}</span></span>
                                                </label>
                                                <div class="controls">

                                                </div>
                                            </div>
                                            <div class="form-group item_index_template 1">
                                                <label class="item-label">有效期至：<span class="check-tips"><span class="small g_valid" style="color: #3B3B3B;">{$g_valid|date='Y-m-d',###}</span></span>
                                                </label>
                                                <div class="controls">
                                                    <!--                                            <input type="text" class="form-control input" style="width: 300px;" name="g_code" value="{$info.g_code}"/>-->
                                                </div>
                                            </div>
                                            <div class="form-group item_index_template 1">
                                                <label class="item-label">续费至：<span class="check-tips">(<span class="small">必须填写</span>)</span>
                                                </label>
                                                <div class="controls">
                                                    <input id="pay_time" placeholder="请选择续费时间" readonly="true"  class="input form-control pay_time" onchange="time_change(this.id)"  type="text" name="or_valid" style="width: 300px"/>
                                                    <input type="button" value="一个月" id="oneMonths"/>
                                                    <input type="button" value="半年" id="halfYears"/>
                                                    <input type="button" value="一年" id="oneYears"/>
                                                </div>
                                            </div>
                                            <div class="form-group item_index_template 1">
                                                <label class="item-label">续费的天数：<span class="check-tips"><span class="or_day" style="color: #3B3B3B;"></span></span>
                                                </label>
                                                <div class="controls">
                                                    <input type="text"  class="form-control input or_day" name="or_day" style="display: none"/>
                                                </div>
                                            </div>    
                                            <div class="form-group item_index_template 1">
                                                <label class="item-label">续费折扣：<span class="check-tips">（<span class="small g_discount" style="color: #3B3B3B;">{$g_discount}</span>）</span>
                                                </label>
                                                <div class="controls">
                                                </div>
                                            </div> 
                                            <div class="form-group item_index_template 1">
                                                <label class="item-label">应付金额(元)：<span class="check-tips"><span class="or_pay small" style="color: #3B3B3B;"></span></span>
                                                </label>
                                                <div class="controls">
                                                    <input   class="input or_pay form-control" type="text" name="or_pay" style="display: none"/>
                                                </div>
                                            </div>    
                                            <div class="form-group item_index_template 1">
                                                <label class="item-label">支付方式：<span class="check-tips">（<span class="small">必须填写</span>）</span>
                                                </label>
                                                <div class="controls">
                                                    <input type="text"  name="or_way" class="input form-control" style="width: 300px;" placeholder="例如：现金/刷卡" />
                                                </div>
                                            </div>    
                                            <div class="form-group item_index_template 1">
                                                <label class="item-label">备注：<span class="check-tips">（<span class="small">可选</span>）</span>
                                                </label>
                                                <div class="controls">
                                                    <textarea name="or_remark" style="width: 300px;height:50px;" type="text">
                                                    </textarea>
                                                </div>
                                            </div>    
                                            <div class="form-group item_index_template 1">
                                                <label class="item-label">是否付款：<span class="check-tips">（<span class="small">必选</span>）</span>
                                                </label>
                                                <div class="controls">
                                                   <input type="radio" name="or_pay_status" value="1" checked="checked" />是&nbsp;<input type="radio" name="or_pay_status" value="0" />否
                                                </div>
                                            </div>    
                                            <!--隐藏的id用于删除用户-->
                                            <input type='hidden' value="{$g_id}" name="g_id" class="g_id"/>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--!-- 底部区域开始 -->
                        <div class="" style="">
                            <button class="btn btn-default exit">取消</button>
                            <button class="btn btn-primary submit ajax-post" type="submit" target-form="builder-form">确定</button>
                        </div>
                        <!-- 底部区域结束 -->
                        <!--页面主题内容结束-->
                    </div>
                </div>
            </div>
        </div>

        <!-- footer开始 -->
    <include file="Common/footer"/>

    <!--<include file="Common/upload_img" />-->
    <!-- footer结束 -->

    <!--        <script type="text/javascript">
                $(function() {
                    webuploaderImg('#uploader-demo', 'face', 1, '{$pic}');
                });
            </script>-->
    <script type="text/javascript">
        $(function() {
            $(".exit").click(function() {
                var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
            });
            $(".submit").click(function() {
                parent.location.href = '{:U("index")}';
            });
//            按一个月来续费
            $("#oneMonths").click(function() {
                var g_valid = $(".g_valid").html();
                var obj = g_valid.split("-");
                switch (obj[1]) {
                    case "01":
                        if (((obj[0] % 4) == 0) && ((obj[0] % 100) != 0) || ((obj[0] % 400) == 0)) {
                            if (obj[2] > 29) {
                                obj[1]++;
                                obj[2] = 29;
                            } else {
                                obj[1]++;
                            }
                        } else {
                            if (obj[2] > 28) {
                                obj[1]++;
                                obj[2] = 28;
                            } else {
                                obj[1]++;
                            }
                        }
                        break;
                    case "03":
                    case "05":
                    case "07":
                    case "08":
                    case "10":
                        if (obj[2] == 31) {
                            obj[1]++;
                            obj[2] = 30;
                        } else {
                            obj[1]++;
                        }
                        break;
                    case "02":
                    case "04":
                    case "06":
                    case "09":
                    case "11":
                        obj[1]++;
                        break;
                    case "12":
                        obj[0]++;
                        obj[1] = 1;
                        break;
                }
                change_valid = obj.join("-");
                $(".pay_time").val(change_valid);
                time_change("pay_time");
            });
            /****快捷键续期,续期半年****/
            $("#halfYears").click(function() {
                var g_valid = $(".g_valid").html();
                var obj = g_valid.split("-");
                switch (obj[1]) {
                    case "01":
                    case "02":
                    case "03":
                    case "04":
                    case "05":
                    case "06":
                        if (obj[2] == 31) {
                            obj[2] = 30;
                            obj[1] = obj[1] + 6;
                        } else {
                            obj[1] = parseInt(obj[1]) + 6;
                        }
                        break;
                    case "07":
                    case "09":
                    case "10":
                    case "11":
                    case "12":
                        if (obj[2] == 31) {
                            obj[2] = 30;
                            obj[1] = parseInt(obj[1]) + 6 - 12;
                            obj[0]++;
                        } else {
                            obj[1] = parseInt(obj[1]) + 6 - 12;
                            obj[0]++;
                        }
                        break;
                    case "08":
                        if (((obj[0] % 4) == 0) && ((obj[0] % 100) != 0) || ((obj[0] % 400) == 0)) {
                            if (obj[2] > 29) {
                                obj[0]++;
                                obj[1] = 2;
                                obj[2] = 29;
                            } else {
                                obj[0]++;
                                obj[1] = 2;
                            }
                        } else {
                            if (obj[2] > 28) {
                                obj[0]++;
                                obj[1] = 2;
                                obj[2] = 28;
                            } else {
                                obj[0]++;
                                obj[1] = 2;
                            }
                        }
                        break;
                }
                change_valid = obj.join("-");
                $(".pay_time").val(change_valid);
                time_change("pay_time");
            });
            /****快捷键续期,续期一年****/
            $("#oneYears").click(function() {
                var g_valid = $(".g_valid").html();
                var obj = g_valid.split("-");
                if ((obj[1] == 2 && obj[2] == 29) && (((obj[0] % 4) == 0) && ((obj[0] % 100) != 0) || ((obj[0] % 400) == 0))) {
                    obj[2] = 28;
                    obj[0]++;
                } else {
                    obj[0]++;
                }
                change_valid = obj.join("-");
                $(".pay_time").val(change_valid);
                time_change("pay_time");
            });
        });
        Calendar.setup({
            weekNumbers: false,
            inputField: "pay_time",
            ifFormat: "%Y-%m-%d"
        });
            </script>
    <script type="text/javascript">
        function time_change(id) {
            var pay_time = (Date.parse(new Date($("#" + id).val()))) / 1000//以秒为单位
            var g_valid = (Date.parse(new Date($(".g_valid").html()))) / 1000; //以秒为单位
            pay_day = (pay_time - g_valid) / (60 * 60 * 24); //得出续费的天数
            pay_day = Math.ceil(pay_day); //向上取整得出整数天数
            $(".or_day").html(pay_day);
            $(".or_day").val(pay_day);
            or_pay = pay_day * 10 * ($(".g_discount").html()); //假设每天十元
            $(".or_pay").html(or_pay);
            $(".or_pay").val(or_pay);
        }

    </script>
</body>
</html>